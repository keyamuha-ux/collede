<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Models | Collede AI Gateway</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script
      async
      crossorigin="anonymous"
      data-clerk-publishable-key="pk_test_YXJyaXZpbmctYXNwLTIuY2xlcmsuYWNjb3VudHMuZGV2JA"
      src="https://arriving-asp-2.clerk.accounts.dev/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"
      type="text/javascript"
    ></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #09090b; color: #fafafa; }
        .nav-link { color: #a1a1aa; transition: color 0.2s; }
        .nav-link:hover { color: #ffffff; }
        .card { background-color: #18181b; border: 1px solid #27272a; border-radius: 0.75rem; }
        .status-badge { font-size: 0.7rem; font-weight: 600; padding: 0.125rem 0.5rem; border-radius: 9999px; text-transform: uppercase; letter-spacing: 0.025em; }
        .status-active { background-color: rgba(16, 185, 129, 0.1); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.2); }
    </style>
</head>
<body>
    <nav class="border-b border-zinc-800 bg-zinc-950/50 backdrop-blur-md sticky top-0 z-50">
        <div class="container mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center space-x-8">
                <a href="/" class="flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-500"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                    <span class="text-lg font-bold tracking-tight">Collede</span>
                </a>
                <div class="hidden md:flex items-center space-x-6">
                    <a href="/models" class="text-sm font-medium text-white">Models</a>
                    <a href="/docs" class="text-sm font-medium nav-link">Documentation</a>
                    <a id="admin-link" href="/admin" class="text-sm font-medium nav-link hidden">Admin Portal</a>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div id="auth-buttons" class="hidden flex items-center space-x-3">
                    <button onclick="Clerk.openSignIn()" class="text-sm font-medium nav-link">Sign In</button>
                    <button onclick="Clerk.openSignUp()" class="text-sm font-medium bg-white text-black px-4 py-2 rounded-lg hover:bg-zinc-200 transition">Get Started</button>
                </div>
                <div id="user-button"></div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-6 py-12">
        <div class="max-w-4xl mx-auto">
            <header class="mb-12">
                <h1 class="text-4xl font-extrabold mb-4">Active Models</h1>
                <p class="text-zinc-400 text-lg">Browse all AI models currently available through the Collede Gateway. These models are synced directly from the configured providers.</p>
            </header>

            <div id="loading-state" class="py-20 flex flex-col items-center justify-center">
                <svg class="animate-spin h-8 w-8 text-indigo-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="text-zinc-500">Fetching available models...</p>
            </div>

            <div id="models-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 hidden">
                <!-- Models will be injected here -->
            </div>

            <div id="empty-state" class="hidden py-20 text-center card p-12">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-zinc-700 mb-4"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>
                <h3 class="text-xl font-semibold mb-2">No models available</h3>
                <p class="text-zinc-500 max-w-sm mx-auto">The gateway administrator hasn't configured any models yet. Please check back later or contact support.</p>
            </div>
        </div>
    </main>

    <script>
        const ADMIN_EMAIL = 'keyamuha@gmail.com';

        window.addEventListener('load', async function () {
            await Clerk.load();

            const userButtonDiv = document.getElementById('user-button');
            const authButtons = document.getElementById('auth-buttons');
            const adminLink = document.getElementById('admin-link');

            if (Clerk.user) {
                Clerk.mountUserButton(userButtonDiv);
                authButtons.classList.add('hidden');
                
                // Show admin link if user is admin
                const email = Clerk.user.primaryEmailAddress.emailAddress;
                if (email === ADMIN_EMAIL) {
                    adminLink.classList.remove('hidden');
                }
                
                fetchModels();
            } else {
                authButtons.classList.remove('hidden');
                document.getElementById('loading-state').innerHTML = `
                    <div class="text-center card p-12 w-full max-w-md mx-auto">
                        <div class="w-16 h-16 bg-white/5 rounded-2xl flex items-center justify-center border border-white/10 mx-auto mb-6">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-zinc-400"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Sign in to view models</h3>
                        <p class="text-zinc-500 mb-8 text-sm">You need an active session to browse available models and access the API.</p>
                        <button onclick="Clerk.openSignIn()" class="bg-white text-black px-8 py-3 rounded-xl font-semibold hover:bg-zinc-200 transition w-full shadow-lg shadow-white/5">Sign In Now</button>
                    </div>
                `;
            }
        });

        async function fetchModels() {
            try {
                const token = await Clerk.session.getToken();
                const response = await fetch('/v1/models', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                renderModels(data.data || []);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loading-state').innerHTML = '<p class="text-red-400">Failed to load models. Please try again.</p>';
            }
        }

        function renderModels(models) {
            const loadingState = document.getElementById('loading-state');
            const grid = document.getElementById('models-grid');
            const emptyState = document.getElementById('empty-state');

            loadingState.classList.add('hidden');

            if (models.length === 0) {
                emptyState.classList.remove('hidden');
                grid.classList.add('hidden');
                return;
            }

            grid.innerHTML = models.map(model => `
                <div class="card p-6 flex flex-col justify-between hover:border-zinc-700 transition group">
                    <div>
                        <div class="flex items-center justify-between mb-4">
                            <span class="status-badge status-active">Active</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-zinc-600 group-hover:text-zinc-400 transition"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                        </div>
                        <h3 class="text-lg font-bold font-mono mb-1 truncate">${model.id}</h3>
                        <p class="text-zinc-500 text-sm">Provider: ${model.owned_by || 'Unknown'}</p>
                    </div>
                    <div class="mt-6 pt-4 border-t border-zinc-800 flex items-center justify-between">
                        <span class="text-xs text-zinc-600">Created: ${new Date(model.created * 1000).toLocaleDateString()}</span>
                        <code class="text-[10px] bg-zinc-900 px-2 py-1 rounded text-zinc-500 border border-zinc-800">v1/chat/completions</code>
                    </div>
                </div>
            `).join('');

            grid.classList.remove('hidden');
            emptyState.classList.add('hidden');
        }
    </script>
</body>
</html>